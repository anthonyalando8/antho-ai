{% extends 'main/index.html'%}

{%block title%}
Mamapesa | Chatbot
{%endblock%}

{%block content%}
<style>
    .top-section{
        overflow: auto;
        word-wrap: break-word;
    }
    textarea {
        resize: none; /* Disable manual resizing */
        overflow-y: auto;
        max-height: 10vh;
    }
    input[type="file"] {
        display: none;
    }
    label{
        cursor: pointer;
    }
</style>
<div class="position-relative">
    <div class="top-section">
    <div class="chats" id="chat">
        {{ default }}
    </div>
</div>
    <div class="bg-light m-2 border rounded">
        <form method="post" id="form" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="input-group">
                <span class="input-group-text" id="basic-addon1">
                    <label for="id_image">
                        <i class="fa-solid fa-paperclip"></i>
                    </label>
                    {{ form.image }}
                </span>
                {{ form.message }}
                <button type="submit" class="btn btn-success btn-block"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </form>  
    </div>

</div>

<script>
    $(document).ready(function() {
        $('#form').submit(function(event) {
            // Prevent the default form submission
            event.preventDefault();

            // Serialize form data
            var formData = new FormData(this);
            // Reference to the submit button
            var submitButton = $('#form button[type="submit"]');

            submitButton.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
            submitButton.attr("disabled","disabled")
            // Clear form fields
            $('#form')[0].reset();

            // Send an AJAX request
            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // Update the content of a div with the new data
                    console.log(response);
                    submitButton.html('<i class="fa-solid fa-paper-plane"></i>');
                    submitButton.removeAttr("disabled")
                    $('#chat').html(response.html);
                    $('#top').scrollTop($('#top')[0].scrollHeight);

                },
                error: function(error) {
                    submitButton.html('<i class="fa-solid fa-paper-plane"></i>');
                    submitButton.removeAttr("disabled")
                    console.log(error);
                }
            });
        });
    });
</script>
    
    
{%endblock%}